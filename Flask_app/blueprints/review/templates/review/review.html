<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Review Page</title>
</head>
<body>
    <div class="container">
        <!-- Display data from Flask -->
        {% for key, value in data.items() %}
            <div class="text" id="text_{{ key }}">
                <strong>{{ key }}:</strong><br>
                <input type="text" id="textbox_{{ key }}" value="{{ value }}" readonly>
                <button class="edit-button" onclick="editText('{{ key }}')">Edit</button>
                <button class="confirm-button" onclick="confirmText('{{ key }}')" style="display:none;">Confirm</button>
            </div>
        {% endfor %}

        <!-- Button to post data to /confirmation route -->
        <button onclick="postDataToConfirmation()">Confirm and Proceed</button>
    </div>

    <script>
        // Function to enable editing of text box
        function editText(key) {
            var textBox = document.getElementById('textbox_' + key);
            textBox.removeAttribute('readonly');
            textBox.focus();
            // Hide edit button and show confirm button
            document.getElementById('text_' + key).querySelector('.edit-button').style.display = 'none';
            document.getElementById('text_' + key).querySelector('.confirm-button').style.display = 'inline-block';
        }

        // Function to confirm text edit
        function confirmText(key) {
            var textBox = document.getElementById('textbox_' + key);
            textBox.setAttribute('readonly', 'readonly');
            var newValue = textBox.value;
            var xhr = new XMLHttpRequest();
            xhr.open('POST', '/review', true);
            xhr.setRequestHeader('Content-Type', 'application/json');
            xhr.onreadystatechange = function() {
                if (xhr.readyState === XMLHttpRequest.DONE && xhr.status === 200) {
                    alert('Text updated successfully!');
                }
            };
            xhr.send(JSON.stringify({ key: key, value: newValue }));
            // Hide confirm button and show edit button
            document.getElementById('text_' + key).querySelector('.edit-button').style.display = 'inline-block';
            document.getElementById('text_' + key).querySelector('.confirm-button').style.display = 'none';
        }

        // Function to post data to /confirmation route
        function postDataToConfirmation() {
            // Create an empty object to store the data
            var data = {};
    
            // Loop through each text box and collect its value
            {% for key, _ in data.items() %}
                var keyName = '{{ key }}';
                var textBoxValue = document.getElementById('textbox_{{ key }}').value;
                data[keyName] = textBoxValue;
            {% endfor %}
    
            // Send AJAX POST request to /confirmation route
            var xhr = new XMLHttpRequest();
            xhr.open('POST', '/send_email', true);
            xhr.setRequestHeader('Content-Type', 'application/json');
            xhr.onreadystatechange = function() {
                if (xhr.readyState === XMLHttpRequest.DONE && xhr.status === 200) {
                    // alert('Data posted successfully to /confirmation');
                    // Optionally, you can redirect to another page after successful post
                    window.location.href = '/confirmation';
                }
            };
            xhr.send(JSON.stringify(data));
        }
    </script>
</body>
</html>
